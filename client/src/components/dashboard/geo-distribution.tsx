import { Card, CardContent } from "@/components/ui/card";
import { useQuery } from "@tanstack/react-query";
import { Skeleton } from "@/components/ui/skeleton";

export function GeoDistribution() {
  // Fetch dashboard stats from API
  const { data: stats, isLoading } = useQuery({
    queryKey: ['/api/dashboard/stats'],
  });

  return (
    <Card>
      <CardContent className="p-6">
        <div className="flex items-center justify-between mb-4">
          <h2 className="text-lg font-medium text-gray-900">Top 5 countries by customers</h2>
          <span className="text-sm text-gray-500">Last 90 days</span>
        </div>
        
        {isLoading ? (
          <Skeleton className="w-full h-[300px] rounded-lg" />
        ) : (
          <div className="relative">
            {/* World map background (using SVG for better responsiveness) */}
            <svg className="w-full h-auto" viewBox="0 0 1000 500" fill="#f3f4f6" opacity="0.25">
              <path d="M781.68,324.4l-2.31,8.68l-12.53,4.23l-3.75-4.4l-1.82,1.3l2.31,3.95l-5.64,0.43l-5.49-10.59 l10.53-3.95l6.79-0.87L781.68,324.4L781.68,324.4z M722.48,317.57l-0.56,2.36l2.43,2.36l-0.56,2.79l-1.46,1.85l-4.68-0.63 l-2.61-1.29l-0.00,0.00l-0.00,0.00l-0.50-2.00l4.16-4.95L722.48,317.57L722.48,317.57z M602.40,319.94l-2.01-0.31l-1.75-1.83 l-0.70-3.70l0.60-1.7h4.25L602.40,319.94L602.40,319.94z M617.80,299.82l-1.95,1.05l-3.66-0.21l-2.58,1.91l-2.63-2.31l0.09-1.17 l3.41-1.66l3.22,0.04l4.20,0.54l0.50,0.90L617.80,299.82L617.80,299.82z M679.92,288.32l-2.94,1.66l-0.07,1.13l3.94,2.38l1.37,3.06 l-1.01-0.13l-5.65-3.75l-0.75-2.25l0.19-4.38L679.92,288.32L679.92,288.32z M676.60,279.06l-4.79,0.33l-2.81,1.34l-4.56,0.19 l-3.30-0.9l3.22-1.4l3.34-0.19l2.06-1.34l5.36,0.71L676.60,279.06L676.60,279.06z M668.27,284.84l-2.63,0.19l-5.17,1.81 l1.65-1.53l3.94-1.15l2.44,0.00L668.27,284.84L668.27,284.84z M658.58,285.97l-2.25,0.76l-0.19-4.09l-2.16-2.76l0.00-0.15 l-0.37-0.31l-4.70-2.02v-1.72l2.06-0.57l5.06,0.57l1.50,0.57l1.69,5.63L658.58,285.97L658.58,285.97z M635.28,280.60l-1.42,1.29 l-7.11-1.15l-3.50-6.42l1.87-2.16l-0.40-3.50l2.36-0.54l0.97,0.09l2.27,5.39l5.32,3.45L635.28,280.60L635.28,280.60z M558.62,289.33 l-2.31,0.24l-3.67-3.84l-0.60-4.40l1.07-2.92l2.17-0.95l2.48,0.71l3.22,3.84l-0.83,5.35L558.62,289.33L558.62,289.33z M557.49,265.23 l-1.50-0.90l-2.06-2.10l-2.78-0.38l-1.31-1.66l0.19-1.81l1.50-1.15l3.33-0.19l0.00,0.00l0.00,0.00l2.00,2.48L557.49,265.23 L557.49,265.23z M553.18,257.40l-2.14-2.43l-2.04-1.15l1.69-2.87l1.60-0.00l2.44,1.62l1.28,2.58L553.18,257.40L553.18,257.40z M545.96,248.35l-1.88-1.72l-2.81,0.57l-0.57-2.39l3.00-2.01l4.13-1.24l1.69,0.57l2.06,1.72l-1.10,2.96L545.96,248.35L545.96,248.35z M524.61,244.87l-1.31-1.81l-0.19-1.05l2.25-1.05l1.88,1.15l0.09,0.95L524.61,244.87L524.61,244.87z M522.03,236.04l-2.61-1.15 l-1.03-2.20l0.09-1.05l2.16-0.76l1.78,0.57l1.31,2.39L522.03,236.04L522.03,236.04z M534.17,241.20l-1.28-1.24l0.00-1.62 l3.00-0.19l0.19,1.24l-0.38,1.05L534.17,241.20L534.17,241.20z M535.76,232.28l-1.22-0.10l-1.38-1.96l-0.50-2.77l2.26-1.93 l2.07,2.93l0.10,2.30L535.76,232.28L535.76,232.28z M533.91,224.59l-0.66-1.53l-3.19-0.86l0.00-1.53l3.28-1.53l1.50,0.38l1.50,2.49 L533.91,224.59L533.91,224.59z M301.48,200.92l3.36-0.59l0.31-3.33l2.56-1.38l3.80,0.06l1.07,1.09l-0.25,1.76l-3.06,2.5v1.47 l-2.06,0.86l-3.17-1.37l-3.49,0.34l-0.35-0.75L301.48,200.92L301.48,200.92z M316.51,199.89l-1.12-0.74l0.03-1.03l0.84-0.12 l0.78,0.99L316.51,199.89L316.51,199.89z M318.02,200.26l0.37-2.63l0.94-1.32l0.47,1.81l-0.47,1.55L318.02,200.26L318.02,200.26z M180.38,267.53l0.66,0.84l0.17,1.85l-2.71,2.54l1.26,3.19l-0.97,0.34l-1.12-1.52l-0.06-2.28l-1.55-0.94l0.22-1.21l-0.62-1.17 l3.11-0.39L180.38,267.53L180.38,267.53z M185.39,268.42l-0.78,1.24l-0.39,2.05l-2.39,1.13l0.11-2.09l1.26-2.49L185.39,268.42 L185.39,268.42z M238.57,239.28l0.45,2.11l-2.32,3.10l-1.04-0.25l-0.20-3.78l0.34-2.11l2.35-0.42L238.57,239.28L238.57,239.28z M129.26,254.20l-0.81,0.79l-0.67-0.45l-0.51-1.91l0.03-2.02l2.34-2.36l0.47,1.24l-0.56,1.91L129.26,254.20L129.26,254.20z M125.55,252.51l-0.42,1.01l-0.73-0.17l-0.87-2.36l0.17-0.79l0.73-0.11l1.46,0.73L125.55,252.51L125.55,252.51z M176.84,248.85 l0.50,0.42l0.50,0.16l0.21,1.80l-0.71,1.54l-1.13,0.21l-1.55-1.33l-0.34-1.80l1.84-0.74L176.84,248.85L176.84,248.85z M212.15,249.26 l0.23,1.38l-0.34,0.59l-2.09-0.76l-0.11-1.38l0.51-0.48L212.15,249.26L212.15,249.26z M315.54,230.72l-0.34,0.75l-0.04-0.27 l-0.09-0.21l0.06-0.19l0.25-0.32L315.54,230.72L315.54,230.72z M311.40,233.67l-1.39-0.04l-0.95-0.90l-0.56-0.17l-0.52-0.34 l0.09-0.86l0.44-0.34l1.78,0.69l1.51,0.30l0.35,0.47l-0.09,0.90L311.40,233.67L311.40,233.67z M357.36,196.28l-1.60,0.34 l-0.04-0.17l0.14-0.60l1.15-0.34l0.53,0.09l0.17,0.51L357.36,196.28L357.36,196.28z M360.03,189.98l1.30,1.07l-0.09,0.43 l-1.15,0.04l-0.21-1.11L360.03,189.98L360.03,189.98z M364.22,187.20l0.53,1.79l-1.15,1.24l-1.66-0.17l-0.68-0.86l-0.28-1.15 l0.28-0.47l1.48-0.56L364.22,187.20L364.22,187.20z M364.17,185.15l-0.86,0.56l-0.84-0.47l0.32-0.73l1.01-0.09L364.17,185.15 L364.17,185.15z M368.11,180.65l-0.24,0.97l-0.02,0.09l-0.15,0.19l-1.60,0.34l-0.17-0.13v-0.77l0.93-0.73l0.82-0.12L368.11,180.65 L368.11,180.65z M165.76,357.28l-6.88-0.18l-1.89,1.16l-9.92-0.09l-0.35-0.46l9.13-2.48l12.66,0.46L165.76,357.28L165.76,357.28z M161.95,344.32l-5.18,1.24l-6.88-0.18l-7.41-0.97l-3.09-0.36l0.18-0.53l6.44-1.33l8.32,0.53l7.76,0.89L161.95,344.32 L161.95,344.32z M132.65,346.21l-4.26,1.24l-0.18-0.71l1.33-0.98l3.45-0.27L132.65,346.21L132.65,346.21z M106.01,422.91 l-1.92,0.40l-3.93-1.07l-1.49-2.21l-0.30-2.14l0.05-0.40l1.21,0.04l1.40,1.50l2.93,1.43L106.01,422.91L106.01,422.91z M48.89,415.73 l2.33,0.67l1.27,1.85l-2.57,0.31l-1.74-0.75l-1.35-0.65l-1.97-0.23l-2.69-0.56l-0.04-1.67l0.42-0.21l0.85,0.31l1.77,0.73 L48.89,415.73L48.89,415.73z M45.62,410.93l0.33,0.79l-1.24,0.60l-0.52-0.10l-0.88-1.78l-0.60-0.20l0.36-0.71l1.73-0.16 L45.62,410.93L45.62,410.93z M43.25,411.39l-0.40,0.56l-0.26-0.54l0.21-0.81l0.24-0.09L43.25,411.39L43.25,411.39z M42.03,409.47 l-0.40,0.00l-0.16-1.15l0.52-0.30l0.21,0.60L42.03,409.47L42.03,409.47z M24.19,391.71l-0.18,0.18l-0.00,0.00l-1.25-0.59 l-0.32-0.73l1.66-0.59l0.46,0.28L24.19,391.71L24.19,391.71z M19.68,389.11l-0.93,0.26l-0.44-0.26l0.09-0.91l0.58-0.24l0.61,0.58 L19.68,389.11L19.68,389.11z M20.33,386.69l-1.05-0.00l-0.00-0.00l-0.00-0.00l0.09-0.33l0.61-0.15l0.47,0.28L20.33,386.69 L20.33,386.69z M21.92,384.92l-0.54,0.35l-0.80-0.47l-0.06-0.41l0.32-0.90l0.78-0.35l0.38,0.41l0.32,0.73L21.92,384.92 L21.92,384.92z M19.24,388.88l-0.00,0.16l-0.00,0.00l-0.00,0.00l-0.19-0.02l-0.49-1.03l0.30-0.62l0.46-0.11l0.60,0.46l0.18,0.31 L19.24,388.88L19.24,388.88z M126.72,384.31l-0.96,0.06l-0.57-0.52l-0.00-0.00l-0.00-0.00l0.35-0.52l0.86-0.46l0.82,0.34 L126.72,384.31L126.72,384.31z M179.56,116.40l-0.60,0.89l-0.47-0.58l-0.32-1.29l0.98-0.98l0.53,0.58L179.56,116.40L179.56,116.40z M176.84,112.51l-1.09,1.15l-1.29-1.15l-0.00-0.71l0.96-0.59l1.09,0.16L176.84,112.51L176.84,112.51z M178.62,111.33l-0.51,0.46 l-0.09-0.87l-0.56-0.58l0.28-0.65l0.81-0.02L178.62,111.33L178.62,111.33z M169.40,106.92l0.42,0.67l-0.04,0.85l-0.56,0.09 l-0.67-1.01l0.11-0.67L169.40,106.92L169.40,106.92z M167.48,108.02l-0.25,0.29l-0.81-0.29l-0.39-0.52l0.23-0.24l0.84,0.07 L167.48,108.02L167.48,108.02z M174.13,95.41l-0.11,1.13l-1.54-0.28l-0.18-0.85l1.04-0.39L174.13,95.41L174.13,95.41z M171.92,86.49 l-0.88,0.33l-0.56-0.17l-0.14-0.62l1.05-0.26L171.92,86.49L171.92,86.49z M171.38,88.17l1.24,2.22l-2.55,1.94l-2.73,1.04 l-0.65-0.56l-0.18-1.11l0.58-1.11l3.12-1.51L171.38,88.17L171.38,88.17z M257.95,158.44l-1.11,0.86l-2.11-0.42l-0.35-0.33 l0.26-1.11l1.70-1.80l0.49,0.04l1.58,1.44L257.95,158.44L257.95,158.44z M252.40,153.57l0.81,1.30l-1.74,0.39l-0.49-0.18 l-0.42-1.30l0.09-0.83l0.65-0.25l0.81,0.53L252.40,153.57L252.40,153.57z M244.76,152.45l-1.31,1.09l-0.77-0.09l-1.31-0.92 l0.72-0.92l1.81-0.54l1.25,0.22l-0.13,0.82L244.76,152.45L244.76,152.45z M312.39,170.56l-0.58,0.55l-2.88-0.46l-0.12-1.14 l2.36-0.58l1.17,0.09l0.92,0.83L312.39,170.56L312.39,170.56z"/>
            </svg>
            
            {/* Data points overlay */}
            <div className="absolute inset-0 p-4">
              {stats?.geoDistribution?.map((geo: any, index: number) => (
                <div 
                  key={index} 
                  className="absolute" 
                  style={{ left: geo.position.left, top: geo.position.top }}
                >
                  <div className="relative">
                    <div className="w-6 h-6 bg-red-500 bg-opacity-20 rounded-full flex items-center justify-center">
                      <div className="w-4 h-4 bg-red-500 rounded-full"></div>
                    </div>
                    <div className="absolute top-7 left-1/2 transform -translate-x-1/2 bg-white rounded px-2 py-0.5 text-xs font-medium shadow">
                      {geo.customers.toLocaleString()}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
}
